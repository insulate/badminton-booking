# คู่มือการใช้งาน: ระบบเปิดบิล (Tab) - จ่ายทีหลัง

## แนวคิด
ลูกค้าที่กำลังใช้สนามแบดมินตันสามารถซื้อสินค้า (น้ำดื่ม, ขนม, ลูกแบด ฯลฯ) โดยยังไม่ต้องจ่ายเงิน แล้วมาชำระรวมกันทีเดียวตอนเลิกเล่น

---

## วิธีที่ 1: เปิดบิลจากหน้า POS

### ขั้นตอน
1. เข้าหน้า **POS - ขายสินค้า**
2. เลือกสินค้าที่ลูกค้าต้องการใส่ตะกร้า
3. ที่ส่วนตะกร้า (ด้านขวา) จะเห็นช่อง **"เปิดบิล (Tab) - จ่ายทีหลัง"** ให้ติ๊กเครื่องหมายถูก
4. กดปุ่ม **"+ เลือกการจอง..."** เพื่อเลือกการจองของลูกค้าคนนั้น
   - จะแสดงรายการจองที่มีสถานะ **confirmed** หรือ **checked-in** ในวันนี้
   - สามารถค้นหาได้จากรหัสจอง, ชื่อ, หรือเบอร์โทร
5. เลือกการจองที่ต้องการ
6. กดปุ่ม **"เปิดบิล (ยังไม่ชำระ)"** (ปุ่มสีส้ม)
7. ระบบจะบันทึกรายการสินค้าเป็น **"ค้างชำระ"** และหักสต็อกทันที

> **หมายเหตุ:** สามารถเปิดบิลได้หลายครั้งต่อ 1 การจอง เช่น ลูกค้าซื้อน้ำตอน 10 โมง แล้วมาซื้อขนมอีกตอนเที่ยง

---

## วิธีที่ 2: เพิ่มสินค้าจากหน้ารายละเอียดการจอง

### ขั้นตอน
1. เข้าหน้า **จัดการการจอง** แล้วกดดูรายละเอียดการจอง
2. ใน Modal รายละเอียด จะเห็นส่วน **"รายการสินค้า (Tab)"** (พื้นหลังสีส้มอ่อน)
3. กดปุ่ม **"เพิ่มสินค้า"** (มุมขวาบนของส่วนนี้)
4. จะเปิดหน้าต่างเลือกสินค้า (Mini POS):
   - ด้านซ้าย: รายการสินค้าทั้งหมด (ค้นหาได้)
   - ด้านขวา: ตะกร้าสินค้าที่เลือก (ปรับจำนวนได้)
5. เลือกสินค้าและจำนวนที่ต้องการ
6. กดปุ่ม **"เพิ่มลงบิล (ยังไม่ชำระ)"**
7. รายการจะแสดงในส่วน "รายการค้างชำระ" ทันที

---

## การชำระเงิน (Settlement)

### เมื่อลูกค้าจะกลับ ให้เปิดรายละเอียดการจอง แล้วกดปุ่ม **"ชำระเงินสินค้า"**

### มี 2 รูปแบบ:

#### 1. จ่ายเฉพาะสินค้า
- เลือกรายการที่ต้องการชำระ (เลือกได้หลายรายการ)
- เลือกวิธีชำระเงิน (เงินสด / โอน / พร้อมเพย์ / บัตรเครดิต)
- ถ้าจ่ายเงินสด → กรอกจำนวนเงินที่รับ ระบบคำนวณเงินทอนให้
- กดยืนยันชำระเงิน

#### 2. จ่ายรวม (ค่าคอร์ท + ค่าสินค้า)
- ระบบจะคำนวณยอดรวมทั้งหมด:
  - ค่าเช่าสนามที่ยังค้างอยู่
  - ค่าสินค้าทั้งหมดที่ยังค้างชำระ
- เลือกวิธีชำระเงิน
- ถ้าจ่ายเงินสด → กรอกจำนวนเงินที่รับ
- กดยืนยัน → ทั้งค่าสนามและค่าสินค้าจะถูกอัพเดทเป็น "ชำระแล้ว" พร้อมกัน

---

## การยกเลิกรายการ (Void)

หากลูกค้าต้องการคืนสินค้าหรือบันทึกผิด:

1. เปิดรายละเอียดการจอง
2. ที่ส่วน "รายการค้างชำระ" จะมีปุ่ม **"ยกเลิก"** ที่แต่ละรายการ
3. กดยกเลิก → ยืนยัน
4. สต็อกจะถูกคืนอัตโนมัติ

> **ข้อจำกัด:** ยกเลิกได้เฉพาะรายการที่ยังไม่ชำระเงินเท่านั้น

---

## การดูประวัติ

### หน้าประวัติการขาย (Sales History)
- มีตัวกรอง **"สถานะการชำระ"** → เลือกดูเฉพาะ "ค้างชำระ (Tab)" หรือ "ชำระแล้ว"
- แต่ละรายการจะแสดง:
  - Badge สถานะ: **สีส้ม** = ค้างชำระ, **สีเขียว** = ชำระแล้ว
  - Badge รหัสจอง: แสดงรหัสจอง (เช่น BK202602260006) ถ้าเป็นรายการ Tab

### สรุปยอดกะ (Shift Summary)
- ยอดค้างชำระ (Tab) จะ **ไม่** ถูกนับเข้ายอดขายของกะ
- จะนับเข้ายอดขายเมื่อชำระเงินแล้วเท่านั้น

---

## ข้อควรรู้

| หัวข้อ | รายละเอียด |
|--------|-----------|
| สต็อก | หักทันทีตอนเปิดบิล ไม่ต้องรอชำระเงิน |
| ยกเลิกการจอง | ถ้ามีรายการค้างชำระอยู่ จะยกเลิกการจองไม่ได้ ต้องชำระหรือยกเลิกรายการสินค้าก่อน |
| หลายรายการ | สามารถเปิดบิลได้หลายครั้งต่อ 1 การจอง |
| วิธีชำระ | รองรับ: เงินสด, โอนเงิน, พร้อมเพย์, บัตรเครดิต |
| เงินทอน | ระบบคำนวณเงินทอนอัตโนมัติเมื่อชำระด้วยเงินสด |
